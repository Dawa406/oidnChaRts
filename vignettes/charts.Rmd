---
title: "Charts"
author: "Martin John Hadley"
date: "`r Sys.Date()`"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{Vignette Title}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

<!-- ANY PACKAGES USED HERE MUST BE LOADED IN THE DESCRIPTION FILE AS WELL !-->

# Load the library

```{r}
library(oidnChaRts)
```


## Grouped Bar Charts

If highcharter is selected, the data will automatically be reshaped into wide format:

```{r}
stacked_bar_chart(data = data_stacked_bar_chart,
                  library = "highcharter",
                  categories.column = ~country,
                  subcategories.column = ~activity,
                  value.column = ~hours)
```

If plotly is selected the data will be provided directly to plotly for visualisation:

```{r}
stacked_bar_chart(data = data_stacked_bar_chart,
                  library = "plotly",
                  categories.column = ~country,
                  subcategories.column = ~activity,
                  value.column = ~hours)
```

### Ordering Categories

Highcharter

```{r}
country_order <- c("United Kingdom", "Canada", "China", "Estonia", "Egypt", "France", "Germany", 
"Ireland", "Saudi Arabia", "Slovakia")
stacked_bar_chart(data = data_stacked_bar_chart,
                  library = "highcharter",
                  categories.column = ~country,
                  categories.order = country_order,
                  subcategories.column = ~activity,
                  value.column = ~hours)
```

Plotly ordered categories:

```{r}
country_order <- c("Canada", "China", "Egypt", "Estonia", "France", "Germany", 
"Ireland", "Saudi Arabia", "Slovakia", "United Kingdom")
stacked_bar_chart(data = data_stacked_bar_chart,
                  library = "plotly",
                  categories.column = ~country,
                  categories.order = country_order,
                  subcategories.column = ~activity,
                  value.column = ~hours)
```

### Explicitly Ordering Subcategories

Highcharter explicitly ordered subcategories:

```{r}
activity_order <- c("Unclassified", "Business", "Overlay", "Personal Visit", "Teleconference")

stacked_bar_chart(data = data_stacked_bar_chart,
                  library = "highcharter",
                  categories.column = ~country,
                  categories.order = country_order,
                  subcategories.column = ~activity,
                  value.column = ~hours,
                  subcategories.order = activity_order)
```

Plotly explicitly ordered subcategories:

```{r}
activity_order <- c("Unclassified", "Business", "Overlay", "Personal Visit", "Teleconference")

stacked_bar_chart(data = data_stacked_bar_chart,
                  library = "plotly",
                  categories.column = ~country,
                  categories.order = country_order,
                  subcategories.column = ~activity,
                  value.column = ~hours,
                  subcategories.order = activity_order)
```

## Stacked Normal

Highcharter explicitly ordered subcategories with stacked bars.

```{r}
activity_order <- c("Unclassified", "Business", "Overlay", "Personal Visit", "Teleconference")

stacked_bar_chart(data = data_stacked_bar_chart,
                  library = "highcharter",
                  categories.column = ~country,
                  categories.order = country_order,
                  subcategories.column = ~activity,
                  value.column = ~hours,
                  subcategories.order = activity_order,
                  stacking.type = "normal")
```

Plotly explicitly ordered subcategories with stacked bars, note that legend order cannot be fixed (https://github.com/plotly/plotly.js/issues/394)

```{r}
activity_order <- c("Unclassified", "Business", "Overlay", "Personal", "Teleconference")

stacked_bar_chart(data = data_stacked_bar_chart,
                  library = "plotly",
                  categories.column = ~country,
                  categories.order = country_order,
                  subcategories.column = ~activity,
                  value.column = ~hours,
                  subcategories.order = activity_order,
                  stacking.type = "normal")
```



## Stacked Percentage

Highcharter explicitly ordered subcategories with stacked bars.

```{r}
activity_order <- c("Unclassified", "Business", "Overlay", "Personal", "Teleconference")

stacked_bar_chart(data = data_stacked_bar_chart,
                  library = "highcharter",
                  categories.column = ~country,
                  categories.order = country_order,
                  subcategories.column = ~activity,
                  value.column = ~hours,
                  subcategories.order = activity_order,
                  stacking.type = "percent")
```

Plotly explicitly ordered subcategories with stacked bars, note that legend order cannot be fixed (https://github.com/plotly/plotly.js/issues/394)

```{r}
activity_order <- c("Unclassified", "Business", "Overlay", "Personal", "Teleconference")

stacked_bar_chart(data = data_stacked_bar_chart,
                  library = "plotly",
                  categories.column = ~country,
                  categories.order = country_order,
                  subcategories.column = ~activity,
                  value.column = ~hours,
                  subcategories.order = activity_order,
                  stacking.type = "percent")
```

# Scatter plot

Basic scatter plots can be created like this:

```{r}
library(highcharter)
scatter_plot(data = data_scatter_plot,
           library = "highcharter",
           x.column = ~x,
           marker.size = 10,
           y.column = ~y,
           traces.column = ~group)
```

We can provide opacity as follows:

```{r}
scatter_plot(data = data_scatter_plot,
           library = "highcharter",
           x.column = ~x,
           marker.size = 10,
           y.column = ~y,
           traces.column = ~group)
```


## Tooltips

Note that all columns are smuggled into the highcharter object, allowing us to customise the tooltip:

```{r}
library(dplyr)
data_scatter_plot <- data_scatter_plot %>%
  mutate(myData = paste("The group is:", group, " and the colour is: ", color))


scatter_plot(data = data_scatter_plot,
           library = "highcharter",
           x.column = ~x,
           marker.size = 10,
           y.column = ~y,
           traces.column = ~group) %>%
  hc_tooltip(
        formatter = JS(
          "function(){
          console.log(this);
          return '<b>' + this.series.name + '</b>' + 
                  '<br/>' +
                  '<b>Custom content: </b>' + this.point.myData +
                  '<br/>' +
                  '<b>x: </b>' + this.x +
                  '<br/>' +
                  '<b>y: </b>' + this.y;}"
          )
        ) 
```





